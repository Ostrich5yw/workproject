<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>layui.dtree帮助手册</title>
    <link rel="stylesheet" href="../layui/css/layui.css">
    <script type="text/javascript" src="../layui/layui.js"></script>

    <link rel="stylesheet" href="../assets/module/dtree/dtree.css">
    <link rel="stylesheet" href="../assets/module/dtree/font/dtreefont.css">
</head>

<body>
<div class="container">
    <div class="layui-row layui-col-space10">
        <div class="layui-fluid">
            <fieldset class="layui-elem-field layui-field-title">
                <legend>测试</legend>
                <div class="layui-field-box">
                    <div class="layui-row layui-col-space10" style="margin-top: 10px;">
                        <div class="layui-col-xs12">
                            <div id="toolbarDiv" style="overflow: auto">
                                <ul id="demoTree" class="dtree" data-id="0"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>
</div>
</body>

<script type="text/javascript">
    layui.extend({
        dtree: '../assets/module/dtree/dtree'
    }).use(['element','layer', 'table', 'code' ,'util', 'dtree', 'form'], function(){
        var element = layui.element, layer = layui.layer, table = layui.table, util = layui.util, dtree = layui.dtree, form = layui.form, $ = layui.$;
        var olddata;
        // $.ajax({
        //     async: false,
        //     url: 'iframe/test2.json',
        //     success: function(res){
        //         olddata = res;
        //         console.log(olddata)
        //     }
        // })
        var DTree1 = dtree.render({
            async: false,
            elem: "#demoTree",
            method: "GET",
            url: 'iframe/test2.json',
            // data: data,
            toolbar:true,
            scroll:"#toolbarDiv",
            dataFormat: "list",  //配置data的风格为list
            toolbarFun: {
                addTreeNode: function(treeNode, $div){
                    console.log(treeNode)
                    var id = treeNode.nodeId.replaceAll("_node_", "00")
                    var title = treeNode.context
                    var parentId = treeNode.parentId.replaceAll("_node_", "00")
                    $.ajax({
                        type: "post",
                        traditional: true,
                        data: {"status": "add", "filename": "test2","id": id, "title": title, "parentId": parentId},
                        url: "request/changenewJson",
                        success: function(result){
                            DTree1.changeTreeNodeAdd(treeNode.nodeId); // 添加成功，返回ID
                            // DTree1.changeTreeNodeAdd(true); // 添加成功
                            // DTree1.changeTreeNodeAdd(result); // 添加成功，返回一个JSON对象
                            // DTree1.changeTreeNodeAdd("refresh"); // 添加成功，局部刷新树
                        },
                        error: function(){
                            DTree1.changeTreeNodeAdd(false); // 添加成功，返回ID
                        }
                    });
                },
                editTreeNode: function(treeNode, $div){
                    console.log(treeNode)
                    if (treeNode.nodeId === "000") {
                        layer.msg("根目录无法修改" , {icon: 2})
                        DTree1.changeTreeNodeEdit(false);//修改失败
                        return
                    }
                    var id = treeNode.nodeId.replaceAll("_node_", "00")
                    var title = treeNode.context
                    var parentId = treeNode.parentId.replaceAll("_node_", "00")
                    $.ajax({
                        type: "post",
                        traditional: true,
                        data: {"status": "edit", "filename": "test2","id": id, "title": title, "parentId": parentId},
                        url: "request/changenewJson",
                        success: function(result){
                            DTree1.changeTreeNodeEdit(true);// 修改成功
                            //DTree1.changeTreeNodeEdit(result.param); // 修改成功，返回一个JSON对象
                        },
                        error: function(){
                            DTree1.changeTreeNodeEdit(false);//修改失败
                        }
                    });
                },
                delTreeNode: function(treeNode, $div){
                    console.log(treeNode)
                    if (treeNode.nodeId === "000") {
                        layer.msg("根目录无法删除" , {icon: 2})
                        DTree1.changeTreeNodeDel(false);// 删除失败1
                        return
                    }
                    var id = treeNode.nodeId.replaceAll("_node_", "00")
                    var title = treeNode.context
                    var parentId = treeNode.parentId.replaceAll("_node_", "00")
                    $.ajax({
                        type: "post",
                        traditional: true,
                        data: {"status": "del", "filename": "test2","id": id, "title": title, "parentId": parentId},
                        url: "request/changenewJson",
                        success: function(result){
                            DTree1.changeTreeNodeDel(true); // 删除成功
                        },
                        error: function(){
                            DTree1.changeTreeNodeDel(false);// 删除失败
                        }
                    });
                }
            }
        });

        dtree.on("node(demoTree)", function(obj){
            layer.msg(JSON.stringify(obj.param));
        })
    });
</script>
</html>

</body>
</html>